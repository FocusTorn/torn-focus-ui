/** @format */

// var fileIcons = {
//     file: { name: "file" },
//     icons: [
//         {
//             name: "image",
//             fileExtensions: [
//                 "jpg",
//                 "gif",
//                 "png"
//             ],
//         },
//         {
//             name: "js",
//             fileExtensions: [
//                 "js",
//                 "mjs"
//             ],
//         },
//         {
//             name: "ts",
//             fileExtensions: ["ts"],
//         },
//         {
//             name: "sh",
//             fileExtensions: ["sh"],
//         },
//         {
//             name: "txt",
//             fileExtensions: ["txt"],
//         },
//         {
//             name: "svg",
//             fileExtensions: ["svg"],
//         },
//         {
//             name: "yaml",
//             fileExtensions: ["yaml"],
//         },
//         {
//             name: "markdown",
//             fileExtensions: ["md"],
//         },
//         {
//             name: "julia",
//             fileExtensions: ["jl"],
//         },
//         {
//             name: "json",
//             fileExtensions: ["json"],
//         },
//         {
//             name: "c",
//             fileExtensions: ["c"],
//         },
//         {
//             name: "cpp",
//             fileExtensions: ["cpp"],
//         },
//         {
//             name: "cs",
//             fileExtensions: ["cs"],
//         },
//         {
//             name: "ahkf",
//             fileExtensions: ["ahk"],
//         },
//         {
//             name: "ahks",
//             fileExtensions: ["ah2"],
//         },
//         {
//             name: "vscode",
//             fileExtensions: [
//                 "vsix",
//                 "code-workspace"
//             ],
//             fileNames: [
//                 "vsc-extension-quickstart.md"
//             ],
//         },
//         {
//             name: "vscode-ignore",
//             fileNames: [".vscodeignore"],
//         },
//         {
//             name: "python",
//             fileExtensions: ["py"],
//         },
//         {
//             name: "python-misc",
//             fileExtensions: [
//                 "pyc",
//                 "whl"
//             ],
//             fileNames: [
//                 ".python-version",
//                 "requirements.txt",
//                 "pipfile",
//                 "manifest.in",
//                 "pylintrc",
//                 "pyproject.toml",
//                 "py.typed",
//             ],
//         },
//         {
//             name: "console",
//             fileExtensions: ["bash"],
//         },
//         {
//             name: "powershell",
//             fileExtensions: ["ps1",
//                 "psm1",
//                 "psd1",
//                 "ps1xml",
//                 "psc1",
//                 "pssc"
//             ],
//         },
//         {
//             name: "readme",
//             fileNames: ["readme.md"],
//         },
//         {
//             name: "git-ignore",
//             fileNames: [".gitignore"],
//         },
//         {
//             name: "license",
//             fileNames: [
//                 "license.txt",
//                 "license.md"
//             ],
//         },
//         {
//             name: "bun-lock",
//             fileNames: ["bun.lockb"],
//         },
//         {
//             name: "bun-config",
//             fileNames: ["bunfig.toml"],
//         },
//         {
//             name: "coderabbit",
//             fileNames: [".coderabbit.yaml"],
//         },
//         {
//             name: "eslint",
//             fileNames: [".eslintrc.json"],
//         },
//         {
//             name: "package",
//             fileNames: ["package.json"],
//         },
//         {
//             name: "package-lock",
//             fileNames: ["package-lock.json"],
//         },
//         {
//             name: "editorconfig",
//             fileNames: [".editorconfig"],
//         },
//         {
//             name: "tsconfig",
//             fileNames: ["tsconfig.json"],
//         },
//         {
//             name: "git",
//             fileNames: [".gitattributes"],
//         },
//         {
//             name: "node-ignore",
//             fileNames: [".npmignore"],
//         },
//     ],
// };


// var folderIcons = {
//     folder: { name: "basic" },
//     rootFolder: { name: "root" },
//     icons: [
//         {
//             name: "vscode",
//             folderNames: [".vscode"],
//         },
//         {
//             name: "source",
//             folderNames: ["src"],
//         },
//         {
//             name: "env",
//             folderNames: [".venv"],
//         },
//         {
//             name: "resources",
//             folderNames: ["resources"],
//         },
//         {
//             name: "git",
//             folderNames: [
//                 ".git",
//                 ".github"
//             ],
//         },
//         {
//             name: "helper",
//             folderNames: [
//                 "helper",
//                 "helpers"
//             ],
//         },
//         {
//             name: "core",
//             folderNames: ["core"],
//         },
//         {
//             name: "dict",
//             folderNames: [
//                 "dict",
//                 "dictionary"
//             ],
//         },
//         {
//             name: "node",
//             folderNames: ["node_modules"],
//         },
//         {
//             name: "script",
//             folderNames: ["scripts"],
//         },
//         {
//             name: "tests",
//             folderNames: [
//                 "test",
//                 "tests",
//                 "_tests",
//                 ".vscode-test"
//             ],
//         },
//         {
//             name: "webpack",
//             folderNames: [".devcontainer"],
//         },
//         {
//             name: "js",
//             folderNames: ["js"],
//         },
//         {
//             name: "ts",
//             folderNames: ["ts"],
//         },
//         {
//             name: "sh",
//             folderNames: ["sh"],
//         },
//         {
//             name: "json",
//             folderNames: ["json"],
//         },
//         {
//             name: "removed",
//             folderNames: [
//                 "_removed",
//                 "_X_removed",
//                 "_XX_removed",
//                 "_XXX_removed",
//                 "removed",
//                 "X_removed",
//                 "XX_removed",
//                 "XXX_removed",
//                 "unused",
//                 "X_unused",
//                 "XX_unused",
//                 "XXX_unused",
//                 "_unused",
//                 "_X_unused",
//                 "_XX_unused",
//                 "_XXX_unused",
//             ],
//         },
//         {
//             name: "notes",
//             folderNames: [
//                 ".notes",
//                 ".pnotes",
//                 "notes",
//                 "pnotes"
//             ],
//         },
//         {
//             name: "out",
//             folderNames: [
//                 "dist",
//                 "out"
//             ],
//         },
//         {
//             name: "images",
//             folderNames: [
//                 "images",
//                 "icons"
//             ],
//         },
//         {
//             name: "theme",
//             folderNames: [
//                 "theme",
//                 "themes"
//             ],
//         },
//         {
//             name: "python",
//             folderNames: [
//                 "python",
//                 ".python",
//                 "_python",
//                 "__python__"
//             ],
//         },
//         {
//             name: "pycache",
//             folderNames: [
//                 "pycache",
//                 ".pycache",
//                 "_pycache",
//                 "__pycache__",
//                 "pytest_cache",
//                 ".pytest_cache",
//                 "_pytest_cache",
//                 "__pytest_cache__",
//             ],
//         },
//     ],
// };


const fileIcons = require('../core/generator/models/file_icons_dictionary.js');
const folderIcons = require('../core/generator/models/folder_icons_dictionary.js');


const icons = 'resources/icons/';
const fileIconsDirectory = icons + 'file_icons/';
const folderIconsDirectory = icons + 'folder_icons/';



// src/core/generator/models/file_icons_dictionary.js

// src/core/generator/models/folder_icons_dictionary.js




const fs = require("fs");
const path = require("path");

// ... (iconsDir, fileIconsDir, folderIconsDir definitions)

function saveToJson(outputFile, data) {
    fs.writeFileSync(outputFile, JSON.stringify(data, null, 4));
}


// Function to generate metadata from a directory
function generateMetadata(directoryPath) {
    const iconsData = {};
    const files = fs.readdirSync(directoryPath);
    for (const file of files) {
        const ext = path.extname(file).toLowerCase();

        if (['.png', '.jpg', '.jpeg', '.gif', '.bmp', '.svg'].includes(ext)) {
            const nameWithoutExt = "_" + path.parse(file).name;
            const filenameWithExt = file;
            const iconPath = './' + path.posix.join(path.basename(directoryPath), filenameWithExt);
            iconsData[nameWithoutExt] = { iconPath };
        }
    }
    return iconsData;
}

function transformIcons(fileIconsData, folderIconsData) {
    const result = {
        iconDefinitions: {}, // Initialize iconDefinitions
        folderNames: {},
        folderNamesExpanded: {},
        fileExtensions: {},
        fileNames: {},
        file: "_file", // Assuming you want a default file icon
        folder: "_folder-basic",
        folderExpanded: "_folder-basic-open",
        rootFolder: "_folder-root",
        rootFolderExpanded: "_folder-root-open",
        languageIds: {},
        hidesExplorerArrows: true,
        highContrast: {
            fileExtensions: {},
            fileNames: {}
        }
    };

    // Function to process icon data (can be reused for files and folders)
    function processIconData(iconsData, type) {
        iconsData.icons.forEach((icon) => {
            if (icon.fileExtensions) {
                icon.fileExtensions.forEach(ext => {
                    if (ext !== "") {
                        result.fileExtensions[ext] = `_${icon.name}`;
                        result.iconDefinitions[`_${icon.name}`] = { iconPath: `./file_icons/${icon.name}.svg` };
                    }
                });
            }

            if (icon.fileNames) {
                icon.fileNames.forEach(name => {
                    if (name !== "") {
                        result.fileNames[name] = `_${icon.name}`;
                        result.iconDefinitions[`_${icon.name}`] = { iconPath: `./file_icons/${icon.name}.svg` };
                    }
                });
            }

            if (icon.folderNames) {
                icon.folderNames.forEach(name => {
                    if (name !== "") {
                        const sanitizedName = name.replace(/[^a-zA-Z0-9]/g, ''); // Remove special characters
                        result.folderNames[name] = `_folder-${sanitizedName}`;
                        result.folderNamesExpanded[name] = `_folder-${sanitizedName}-open`;
                        result.iconDefinitions[`_folder-${sanitizedName}`] = { iconPath: `./folder_icons/folder-${sanitizedName}.svg` };
                        result.iconDefinitions[`_folder-${sanitizedName}-open`] = { iconPath: `./folder_icons/folder-${sanitizedName}-open.svg` };
                    }
                });
            }
        });
    }

    // Process both file and folder icons from dictionary files
    processIconData(fileIconsData, "file");
    processIconData(folderIconsData, "folder");

    // Generate metadata for file and folder icons from directories
    const generatedFileIcons = generateMetadata(fileIconsDirectory);
    const generatedFolderIcons = generateMetadata(folderIconsDirectory);

    // Add generated icons to iconDefinitions
    Object.assign(result.iconDefinitions, generatedFileIcons);
    Object.assign(result.iconDefinitions, generatedFolderIcons);

    // Add generated file icons to fileNames
    for (const [name, data] of Object.entries(generatedFileIcons)) {
        result.fileNames[name] = data.iconPath;
    }

    // Add generated folder icons to folderNames and folderNamesExpanded
    for (const [name, data] of Object.entries(generatedFolderIcons)) {
        result.folderNames[name.replace('-open', '')] = name;
        result.folderNamesExpanded[name.replace('-open', '')] = name;
    }

    return result;
}

const combinedIconsData = transformIcons(fileIcons, folderIcons);

// saveToJson(path.join(__dirname, "icons.json"), combinedIconsData);
saveToJson(icons + 'torn_focus_icons.json', combinedIconsData);

console.log(`Icons saved to: ${icons + 'torn_focus_icons.json'}`);




// // Now you can call transformIcons once with both data sets
// const combinedIconsData = transformIcons(fileIcons, folderIcons);

// // saveToJson(path.join(__dirname, "icons.json"), combinedIconsData);
// saveToJson(icons + 'torn_focus_icons.json', combinedIconsData);

// console.log(`Icons saved to: ${path.join(__dirname, "icons.json")}`);




















// function transformIcons(fileIconsData, folderIconsData) {
//     const result = {
//         fileExtensions: {}, // Initialize fileExtensions here
//         fileNames: {},
//         folderNames: {},
//         folderNamesExpanded: {},
//         file: fileIconsData.file.name,
//         folder: `_folder-${folderIconsData.folder.name}`,
//         folderExpanded: `_folder-${folderIconsData.folder.name}-open`,
//         rootFolder: `_folder-${folderIconsData.rootFolder.name}`,
//         rootFolderExpanded: `_folder-${folderIconsData.rootFolder.name}-open`,
//         languageIds: {},
//         hidesExplorerArrows: true,
//         highContrast: {
//             fileExtensions: {},
//             fileNames: {}
//         }
//     };

//     // Function to process icon data (can be reused for files and folders)
//     function processIconData(iconsData, type) {
//         const encounteredNames = new Set();

//         iconsData.icons.forEach((icon) => {
//             if (icon.name && encounteredNames.has(icon.name)) {
//                 console.warn(`Warning: Duplicate ${type} icon name found:`, icon.name);
//             } else if (icon.name) {
//                 encounteredNames.add(icon.name);
//             }

//             if (icon.fileExtensions) {
//                 icon.fileExtensions.forEach(ext => {
//                     if (ext !== "") {
//                         result.fileExtensions[ext] = `_${icon.name}`;
//                     }
//                 });
//             }

//             if (icon.fileNames) {
//                 icon.fileNames.forEach(name => {
//                     if (name !== "") {
//                         result.fileNames[name] = `_${icon.name}`;
//                     }
//                 });
//             }

//             if (icon.folderNames) {
//                 icon.folderNames.forEach(name => {
//                     if (name !== "") {
//                         result.folderNames[name] = `_folder-${icon.name}`;
//                         result.folderNamesExpanded[name] = `_folder-${icon.name}-open`;
//                     }
//                 });
//             }
//         });
//     }

//     // Process both file and folder icons
//     processIconData(fileIconsData, "file");
//     processIconData(folderIconsData, "folder");

//     return result;
// }






// // Now you can call transformIcons once with both data sets
// const combinedIconsData = transformIcons(fileIcons, folderIcons);

// // saveToJson(path.join(__dirname, "icons.json"), combinedIconsData);
// saveToJson(icons + 'torn_focus_icons.json', combinedIconsData);

// console.log(`Icons saved to: ${path.join(__dirname, "icons.json")}`);


























// function transformIcons(iconsData, type) {
//     const result = {};

//     // Handle default icons for file and folder
//     if (type === 'file') {
//         result[`${type}`] = iconsData[type].name;
//     } else if (type === 'folder') {
//         result[`${type}`] = `_folder-${iconsData[type].name}`;
//         result[`${type}Expanded`] = `_folder-${iconsData[type].name}-open`;
//         result[`root${type}`] = `_folder-${iconsData.rootFolder.name}`;
//         result[`root${type}Expanded`] = `_folder-${iconsData.rootFolder.name}-open`;
//     }

//     // Handle fileExtensions, fileNames, and folderNames
//     if (type === 'file') {
//         result[`${type}Extensions`] = {}; // Only for files
//     }
//     result[`${type}Names`] = {};

//     // Only add 'NamesExpanded' for folder types
//     if (type === 'folder') {
//         result[`${type}NamesExpanded`] = {}; // For expanded folder icons
//     }

//     iconsData.icons.forEach((icon) => {
//         // ... (rest of your code to process icons) ...

//         if (icon[`${type}Names`]) {
//             icon[`${type}Names`].forEach(name => {
//                 if (name !== "") {
//                     result[`${type}Names`][name] = `_${icon.name}`;

//                     // Add expanded folder names ONLY for folders
//                     if (type === 'folder') {
//                         result[`${type}NamesExpanded`][name] = `_${icon.name}-open`;
//                     }
//                 }
//             });
//         }
//     });

//     return result;
// }

// const combinedIconsData = {
//     ...transformIcons(fileIcons, "file"),
//     ...transformIcons(folderIcons, "folder"),
//     // Add other properties like languageIds, hidesExplorerArrows, highContrast
//     "languageIds": {},
//     "hidesExplorerArrows": true,
//     "highContrast": {
//         "fileExtensions": {},
//         "fileNames": {}
//     }
// };

// saveToJson(path.join(__dirname, "icons.json"), combinedIconsData);
// console.log(`Icons saved to: ${path.join(__dirname, "icons.json")}`);








// standard VS Code icon theme format.
// desired structure of the output json file:



// {
//     "folderNames": {

// "js": "_js",
// "js2": "_js2",
// "json": "_json",
// "jl": "_julia",

//     },

//     "folderNamesExpanded": {


// "js": "_js",
// "js2": "_js2",
// "json": "_json",
// "jl": "_julia",


//     },

//     "fileExtensions": {


// "js": "_js",
// "js2": "_js2",
// "json": "_json",
// "jl": "_julia",


//     },

//     "fileNames": {


// "js": "_js",
// "js2": "_js2",
// "json": "_json",
// "jl": "_julia",


//     },

//     "file": "file",

//     "folder": "_folder-basic",
//     "folderExpanded": "_folder-basic-open",

//     "rootFolder": "_folder-root",
//     "rootFolderExpanded": "_folder-root-open",

//     "languageIds": {},
//     "hidesExplorerArrows": true,
//     "highContrast": {
//         "fileExtensions": {},
//         "fileNames": {}
//     }



// }
